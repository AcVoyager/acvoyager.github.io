<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;acvoyager.github.io&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Gemini&quot;,&quot;version&quot;:&quot;8.4.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:true,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;Searching...&quot;,&quot;empty&quot;:&quot;We didn&#39;t find any results for the search: ${query}&quot;,&quot;hits_time&quot;:&quot;${hits} results found in ${time} ms&quot;,&quot;hits&quot;:&quot;${hits} results found&quot;},&quot;path&quot;:&quot;&#x2F;search.xml&quot;,&quot;localsearch&quot;:{&quot;enable&quot;:true,&quot;trigger&quot;:&quot;auto&quot;,&quot;top_n_per_article&quot;:1,&quot;unescape&quot;:false,&quot;preload&quot;:false}}</script>
<meta name="description" content="malloc()åœ¨æ“ä½œç³»ç»Ÿä¸­æ˜¯æ€æ ·å®ç°çš„ï¼Ÿ æœ€è¿‘è¢«é—®åˆ°äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œç•¥ä½œæœç´¢ï¼Œå‘ç°ç‰µæ‰¯åˆ°äº†ä¸€ç³»åˆ—æ“ä½œç³»ç»Ÿæ–¹é¢çš„çŸ¥è¯†ï¼Œé‚æ’°æ–‡ä»¥è®°ä¹‹ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="How malloc() works?">
<meta property="og:url" content="https://acvoyager.github.io/2020/12/17/How-malloc-works/index.html">
<meta property="og:site_name" content="The Endeavour">
<meta property="og:description" content="malloc()åœ¨æ“ä½œç³»ç»Ÿä¸­æ˜¯æ€æ ·å®ç°çš„ï¼Ÿ æœ€è¿‘è¢«é—®åˆ°äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œç•¥ä½œæœç´¢ï¼Œå‘ç°ç‰µæ‰¯åˆ°äº†ä¸€ç³»åˆ—æ“ä½œç³»ç»Ÿæ–¹é¢çš„çŸ¥è¯†ï¼Œé‚æ’°æ–‡ä»¥è®°ä¹‹ã€‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://acvoyager.github.io/2020/12/17/How-malloc-works/1.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/12/17/How-malloc-works/2.png">
<meta property="og:image" content="https://acvoyager.github.io/2020/12/17/How-malloc-works/3.png">
<meta property="article:published_time" content="2020-12-18T06:15:28.000Z">
<meta property="article:modified_time" content="2021-01-07T20:05:58.878Z">
<meta property="article:author" content="Voyager">
<meta property="article:tag" content="OS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://acvoyager.github.io/2020/12/17/How-malloc-works/1.png">


<link rel="canonical" href="https://acvoyager.github.io/2020/12/17/How-malloc-works/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;en&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;https:&#x2F;&#x2F;acvoyager.github.io&#x2F;2020&#x2F;12&#x2F;17&#x2F;How-malloc-works&#x2F;&quot;,&quot;path&quot;:&quot;2020&#x2F;12&#x2F;17&#x2F;How-malloc-works&#x2F;&quot;,&quot;title&quot;:&quot;How malloc() works?&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>How malloc() works? | The Endeavour</title><script src="/js/config.js"></script>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168368135-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{&quot;tracking_id&quot;:&quot;UA-168368135-1&quot;,&quot;only_pageview&quot;:false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">The Endeavour</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Virtual-Memory-VM"><span class="nav-number">2.</span> <span class="nav-text">Virtual Memory(VM)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Translate-from-Virtual-Address-to-Physical-Address"><span class="nav-number">3.</span> <span class="nav-text">Translate from Virtual Address to Physical Address</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VM-caching"><span class="nav-number">4.</span> <span class="nav-text">VM caching</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Page-Table%EF%BC%88%E9%A1%B5%E8%A1%A8%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">Page Tableï¼ˆé¡µè¡¨ï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Thrashing"><span class="nav-number">6.</span> <span class="nav-text">Thrashing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory-Management"><span class="nav-number">7.</span> <span class="nav-text">Memory Management</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Voyager</p>
  <div class="site-description" itemprop="description">å›é¦–å‘æ¥è§ç‘Ÿå¤„ï¼Œå½’å»</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/AcVoyager" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;AcVoyager" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xcvoyager01@gmail.com" title="E-Mail â†’ mailto:xcvoyager01@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://acvoyager.github.io/portfolio5610/" title="https:&#x2F;&#x2F;acvoyager.github.io&#x2F;portfolio5610&#x2F;">My Portfolio</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://acvoyager.github.io/2020/12/17/How-malloc-works/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Voyager">
      <meta itemprop="description" content="å›é¦–å‘æ¥è§ç‘Ÿå¤„ï¼Œå½’å»">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The Endeavour">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          How malloc() works?
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-12-17 22:15:28" itemprop="dateCreated datePublished" datetime="2020-12-17T22:15:28-08:00">2020-12-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-01-07 12:05:58" itemprop="dateModified" datetime="2021-01-07T12:05:58-08:00">2021-01-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E6%96%87-English/" itemprop="url" rel="index"><span itemprop="name">ä¸­æ–‡, English</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="firestore-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/12/17/How-malloc-works/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/12/17/How-malloc-works/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>malloc()åœ¨æ“ä½œç³»ç»Ÿä¸­æ˜¯æ€æ ·å®ç°çš„ï¼Ÿ</p>
<p>æœ€è¿‘è¢«é—®åˆ°äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œç•¥ä½œæœç´¢ï¼Œå‘ç°ç‰µæ‰¯åˆ°äº†ä¸€ç³»åˆ—æ“ä½œç³»ç»Ÿæ–¹é¢çš„çŸ¥è¯†ï¼Œé‚æ’°æ–‡ä»¥è®°ä¹‹ã€‚</p>
<a id="more"></a>

<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡çš„å†…å®¹å¤§å¤šå¼•ç”¨/æ€»ç»“äºã€Šæ·±å…¥äº†è§£è®¡ç®—æœºç³»ç»Ÿã€‹â€“ Computer Systems: A Programmerâ€™s Perspective, Randal E. Bryant and David R. Oâ€™Hallaron. 2015.</p>
<p>ä¸ºäº†è§£é‡Šæ–‡ç« ä¸€å¼€å§‹æå‡ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä»è™šæ‹Ÿå†…å­˜ï¼ˆVirtual Memoryï¼‰å¼€å§‹è¯´èµ·ã€‚</p>
<h2 id="Virtual-Memory-VM"><a href="#Virtual-Memory-VM" class="headerlink" title="Virtual Memory(VM)"></a>Virtual Memory(VM)</h2><p>ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿå†…å­˜ï¼ŸåŸå› æœ‰äºŒï¼š</p>
<ol>
<li>ç‰©ç†å†…å­˜æœ‰é™ï¼Œå¦‚æœè¿›ç¨‹æ•°é‡å¾ˆå¤šï¼Œä¸è¶³ä»¥ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…è¶³å¤Ÿçš„èµ„æºã€‚</li>
<li>å†…å­˜å®¹æ˜“è¢«æ¶æ„ç¯¡æ”¹(vulnerable to corruption)ï¼Œæ¯”å¦‚æœ‰äº›è¿›ç¨‹å¯èƒ½ä¼šæ¶æ„åœ°å‘å…¶ä»–è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ç©ºé—´å†™å…¥æ•°æ®ã€ç¯¡æ”¹ã€‚</li>
</ol>
<p>è™šæ‹Ÿå†…å­˜åšåˆ°äº†ä»€ä¹ˆï¼Ÿæœ‰ä¸‰ç‚¹</p>
<ol>
<li>æŠŠä¸»å­˜å½“ä½œdiskçš„cacheæ¥ç”¨ï¼Œåªåœ¨ä¸»å­˜ä¸­ä¿ç•™activeçš„æ•°æ®ï¼ˆLRUï¼‰ã€‚ä¸å¾—ä¸è¯´è¿™æ˜¯ä¸€ç§å¾ˆæœ‰è¶£çš„æƒ³æ³•ã€‚</li>
<li>é€šè¿‡ç»™æ¯ä¸ªè¿›ç¨‹ä¸€ä¸ªç»Ÿä¸€çš„åœ°å€ç©ºé—´ï¼Œæ¥ç®€åŒ–å­˜å‚¨ç®¡ç†ã€‚</li>
<li>ï¼ˆcounterä¸Šä¸€æ®µçš„ç¬¬äºŒä¸ªåŸå› ï¼‰é˜²æ­¢è¿›ç¨‹çš„åœ°å€ç©ºé—´è¢«å…¶ä»–çš„è¿›ç¨‹æ±¡æŸ“ã€‚</li>
</ol>
<p>åŸæ–‡æœ‰ä¸€æ®µè¯å¾ˆæœ‰æ„æ€ï¼Œè¿™æ®µè¯ä¸­ï¼Œä¹Ÿå‡ºç°äº†å…³é”®è¯mallocï¼š</p>
<blockquote>
<p>Virtual memory is dangerous. Applications interact with virtual memory every time they reference a variable, dereference a pointer, or make a call to a <strong>dynamic allocation</strong> package such as <strong>malloc</strong>. If virtual memory is used improperly, applications can suffer from perplexing and insidious memory-related bugs. For example, a program with a bad pointer can crash immediately with a â€œsegmentation faultâ€ or a â€œprotection fault,â€ run silently for hours before crashing, or scariest of all, run to completion with incorrect results. Understanding virtual memory, and the allocation packages such as malloc that manage it, can help you avoid these errors.</p>
</blockquote>
<p>ä¸Šæ–‡æåˆ°ï¼Œåœ¨ä½¿ç”¨VMçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ä¸€äº›ç”±äºè¯¯ä½¿ç”¨æŒ‡é’ˆå¯¼è‡´çš„é”™è¯¯ï¼Œæ¯”å¦‚è¯´æ®µé”™è¯¯(segmentation fault)ç­‰ã€‚</p>
<h2 id="Translate-from-Virtual-Address-to-Physical-Address"><a href="#Translate-from-Virtual-Address-to-Physical-Address" class="headerlink" title="Translate from Virtual Address to Physical Address"></a>Translate from Virtual Address to Physical Address</h2><p><img src="1.png" alt=""></p>
<p>ä¸€äº›éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p>
<ul>
<li>VAåˆ°PAçš„ç¿»è¯‘è€…æ˜¯MMUï¼ŒMMUæ˜¯ä¸€ä¸ªåœ¨CPUä¸Šçš„ç¡¬ä»¶</li>
<li>â€œâ€¦MMU use a lookup table in main memory..â€ MMUè¿›è¡Œç¿»è¯‘æ—¶ä½¿ç”¨ä¸€ä¸ªåœ¨<strong>ä¸»å­˜</strong>å­˜å‚¨çš„è¡¨ã€‚å®é™…ä¸Šè¿™ä¸ªè¡¨å°±æ˜¯<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Memory_management_unit#Page_table_entries">é¡µè¡¨</a>ã€‚</li>
</ul>
<h2 id="VM-caching"><a href="#VM-caching" class="headerlink" title="VM caching"></a>VM caching</h2><p>ç¡¬ç›˜ä¸Šçš„æ•°æ®æŒ‰ç…§blockæ¥ä¸main memoryäº¤æ¢ï¼Œå› æ­¤VMç©ºé—´ä¹Ÿæ˜¯æŒ‰blockæ¥åˆ’åˆ†çš„ï¼Œæ¯ä¸ªblockå«åšvirtual page(VP). ç›¸ä¼¼åœ°ï¼ŒPAä¹Ÿæ˜¯æŒ‰ç…§blockæ¥åˆ’åˆ†ï¼Œæ¯ä¸ªblockå«åšPPï¼Œä¹Ÿå«åšpage frame. VPä¸PPçš„å¤§å°æ˜¯ç›¸åŒçš„ã€‚</p>
<p><strong>Virtual Pageå­˜å‚¨åœ¨diskä¸Š</strong>ã€‚</p>
<p>ä»»ä¸€æ—¶é—´ï¼Œä¸€ä¸ªVPä¼šå¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¸­çš„ä¸€ç§ï¼š</p>
<ol>
<li>Unallocated. è¿™ä¸ªVPå°šæœªè¢«åˆ†é…æ•°æ®</li>
<li>Cached. è¿™ä¸ªVPå·²ç»è¢«åˆ†é…æ•°æ®ï¼Œå¹¶ä¸”æ•°æ®åœ¨ç‰©ç†å†…å­˜ä¸­cached</li>
<li>Uncached. è¿™ä¸ªVPçš„æ•°æ®æ²¡æœ‰åœ¨ç‰©ç†å†…å­˜ä¸­cached</li>
</ol>
<p>L1, L2, L3 cacheåæ–‡ç®€ç§°SRAMï¼ŒVMä¸­ä¸main memoryäº¤äº’çš„cacheåæ–‡ç§°ä¸ºDRAM</p>
<p>DRAMçš„æ€§è´¨</p>
<ul>
<li>VPæ¯”è¾ƒå¤§ï¼Œ4KB â€“ 2MB</li>
<li>fully associativeï¼ˆè¯´çœŸçš„æˆ‘ä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ï¼‰ï¼Œæ„æ€å°±æ˜¯ä¸€ä¸ªVPå¯ä»¥è¢«æ”¾ç½®åœ¨ä»»ä½•ä¸€ä¸ªPPä½ç½®ä¸Š</li>
<li>DRAM cacheé‡‡ç”¨write-backè€Œéwrite-throughã€‚<a target="_blank" rel="noopener" href="https://stackoverflow.com/a/57367793/9045814">write-back vs write-through</a>ï¼Œç®€å•æ¥è¯´å°±æ˜¯write-backåªå†™å›åˆ°cacheï¼Œé™¤éè¦è¢«replacedå¦åˆ™ä¸å†™é“çœŸæ­£çš„å­˜å‚¨ï¼ˆdiskï¼‰ä¸­ï¼Œæ‰€ä»¥é€Ÿåº¦å¿«</li>
</ul>
<h2 id="Page-Tableï¼ˆé¡µè¡¨ï¼‰"><a href="#Page-Tableï¼ˆé¡µè¡¨ï¼‰" class="headerlink" title="Page Tableï¼ˆé¡µè¡¨ï¼‰"></a>Page Tableï¼ˆé¡µè¡¨ï¼‰</h2><p><img src="2.png" alt=""></p>
<p>PTE represents page table entriesï¼Œè¿™äº›entriesç»„æˆäº†é¡µè¡¨. æ­¤å¤„å‡è®¾PTEæœ‰ä¸¤ä¸ªfieldsï¼Œvalid bitå’Œaddress fieldã€‚</p>
<p>Valid bitè¡¨ç¤ºæ˜¯å¦åœ¨DRAMä¸­cachedã€‚ä¸addressåŒºä¸€èµ·ï¼Œè¿™äºŒè€…æœ‰å¦‚ä¸‹ä¸‰ç§ç»„åˆ</p>
<ul>
<li>Valid bit = 1, address -&gt; the start of corresponding physical address</li>
<li>Valid bit = 0, address = null -&gt; not allocated</li>
<li>Valid bit = 0, adress -&gt; the start of corresponding virtual address</li>
</ul>
<p>åˆ†åˆ«å¯¹åº”æˆ‘ä»¬æ—©äº›æåˆ°çš„cached, unallocated and uncached.</p>
<p>å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªvirtual addresså»é¡µè¡¨é‡Œé¢æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœæŸ¥åˆ°çš„é‚£ä¸ªvalid bit=1ï¼Œè¯´æ˜å·²ç»åœ¨physical memoryä¸­cachedäº†ã€‚è¿™ç§æƒ…å†µå«åšpage hitã€‚</p>
<p>å¦‚æœvalid bit=0ï¼Œé‚£ä¹ˆè¯´æ˜æ²¡æœ‰è¢«cachedã€‚è¿™æ ·çš„è¯ï¼Œå°±ä¼šè§¦å‘page faultï¼ŒæŠ›å‡ºä¸€ä¸ªpage fault exceptionã€‚æ“ä½œç³»ç»Ÿkernelä¼šå¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œç„¶åé€šè¿‡æŸç§ç®—æ³•å°†physical memoryä¸­çš„æŸä¸ªpageæ›¿æ¢æˆæˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ªã€‚æ³¨æ„ä¸Šé¢è¯´è¿‡DRAMï¼Œä¹Ÿå°±æ˜¯physical memoryï¼Œä¹Ÿå°±æ˜¯ä¸»å­˜ï¼ˆè¿™ä¸‰ä¸ªåœ¨æ­¤è¯­å¢ƒä¸‹å°±æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼‰ï¼Œæ˜¯write-backçš„ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ï¼Œå½“è¢«æ›¿æ¢çš„æ—¶å€™ï¼Œæ‰ä¼šæŠŠç°åœ¨çš„å€¼å†™ä¼šåˆ°diské‡Œé¢ã€‚</p>
<p><img src="3.png" alt=""></p>
<p>æŠŠä¸€ä¸ªblockï¼ˆpageï¼‰ä»DRAMè½¬åˆ°Diskçš„æ“ä½œå«swap inï¼Œåä¹‹swap outã€‚ä¸Šè¿°é‚£ç§æ–¹å¼ä¹Ÿç§°ä¸ºdemand pagingã€‚</p>
<p><strong>å½“æˆ‘ä»¬éœ€è¦åˆ†é…å†…å­˜(allocating)çš„æ—¶å€™ï¼Œç›¸å½“äºåœ¨é¡µè¡¨ä¸­å°†åŸæ¥çš„nullå˜ä¸ºåˆ†é…åˆ°çš„virtual pageçš„åœ°å€ã€‚å› ä¸ºè¿˜æ²¡æœ‰è®¿é—®ï¼Œæ‰€ä»¥valid=0ï¼Œæ²¡æœ‰è¢«cachedï¼Œaddress fieldæŒ‡å‘çš„æ˜¯VA</strong>ã€‚</p>
<p>ğŸ‘†å°±æ˜¯æˆ‘ä»¬æœ¬æ–‡å¼€ç¯‡çš„ç­”æ¡ˆã€‚</p>
<h2 id="Thrashing"><a href="#Thrashing" class="headerlink" title="Thrashing"></a>Thrashing</h2><p>ï¼ˆä¸­æ–‡åé¢ ç°¸ï¼Ÿ</p>
<p>å‡è®¾ä¸€ä¸ªè¿›ç¨‹çœŸæ­£éœ€è¦çš„æ•°æ®pageså‘½åä¸ºworking setï¼Œé‚£ä¹ˆå½“working setçš„å¤§å°å¾ˆå¤§ï¼Œè¶…è¿‡äº†DRAMå¤§å°çš„æ—¶å€™ï¼Œè¿™ç§æƒ…å†µå«åšthrashingã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œpagesä¼šæŒç»­æ€§åœ°swap in/outï¼Œå¯¼è‡´è¿è¡Œæ€§èƒ½ä¸¥é‡ä¸‹é™ã€‚åè¿‡æ¥è®²ï¼Œå¦‚æœä¸€ä¸ªç¨‹åºçªç„¶è·‘çš„å¾ˆæ…¢çš„æ—¶å€™ï¼Œè€ƒè™‘æ˜¯ä¸æ˜¯å‘ç”Ÿäº†thrashingã€‚</p>
<h2 id="Memory-Management"><a href="#Memory-Management" class="headerlink" title="Memory Management"></a>Memory Management</h2><p>å½“OSä¸­è¿è¡Œäº†å¤šä¸ªè¿›ç¨‹æ—¶ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªé¡µè¡¨ã€‚æ¯ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå› æ­¤å¯ä»¥ç®€åŒ–linkingã€‚</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Voyager
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://acvoyager.github.io/2020/12/17/How-malloc-works/" title="How malloc() works?">https://acvoyager.github.io/2020/12/17/How-malloc-works/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/OS/" rel="tag"># OS</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/12/02/2PC-3PC-and-Raft/" rel="prev" title="2PC, 3PC and Raft">
                  <i class="fa fa-chevron-left"></i> 2PC, 3PC and Raft
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/12/27/%E5%AE%9E%E7%8E%B0sqrt-x-%E5%92%8Cpow-x-n/" rel="next" title="å®ç°sqrt(x)å’Œpow(x, n)">
                  å®ç°sqrt(x)å’Œpow(x, n) <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  <script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Voyager</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>






  

  <script src="https://cdn.jsdelivr.net/npm/firebase@8.4.2/firebase-app.js" integrity="sha256-aS+rZ1asHNtiV5W1+xXQ5lgWF8vMvIqUGYkHJetOD9A=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/firebase@8.4.2/firebase-firestore.js" integrity="sha256-hCnXfO8mXFtVSaEv9mZUk6Dw2xIcWZj+ABYvThpJCJg=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="firestore" type="application/json">{&quot;enable&quot;:true,&quot;collection&quot;:&quot;articles&quot;,&quot;apiKey&quot;:&quot;AIzaSyDY9_gdwlZQh3pD0aOUUt4qoOuS_Cnn7L8&quot;,&quot;projectId&quot;:&quot;my-blog-9d335&quot;}</script>
  <script src="/js/third-party/statistics/firestore.js"></script>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{&quot;enable&quot;:true,&quot;tags&quot;:&quot;none&quot;,&quot;mhchem&quot;:false,&quot;js&quot;:{&quot;url&quot;:&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;mathjax@3.1.4&#x2F;es5&#x2F;tex-mml-chtml.js&quot;,&quot;integrity&quot;:&quot;sha256-ncNI9OXOS5Ek4tzVYiOMmN&#x2F;KKCPZ6V0Cpv2P&#x2F;zHntiA&#x3D;&quot;}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{&quot;enable&quot;:true,&quot;shortname&quot;:&quot;voyager&quot;,&quot;count&quot;:true,&quot;i18n&quot;:{&quot;disqus&quot;:&quot;disqus&quot;}}</script>
<script src="/js/third-party/comments/disqus.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
